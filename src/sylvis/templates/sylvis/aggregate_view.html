{% extends "admin/change_form.html" %}

{% load model_display_utils i18n mptt_tags admin_urls admin_modify %}


{% block extrahead %}
<link href=”http://cdn.pydata.org/bokeh/release/bokeh-2.4.2.min.css" rel=”stylesheet” type=”text/css”>
<link href=”http://cdn.pydata.org/bokeh/release/bokeh-widgets-2.4.2.min.css" rel=”stylesheet” type=”text/css”>
<script src="https://cdn.bokeh.org/bokeh/release/bokeh-2.4.2.min.js"></script>
<script src="https://cdn.bokeh.org/bokeh/release/bokeh-widgets-2.4.2.min.js"></script>
<script src="https://cdn.bokeh.org/bokeh/release/bokeh-tables-2.4.2.min.js"></script>
<script src="https://cdn.bokeh.org/bokeh/release/bokeh-api-2.4.2.min.js"></script>
{{bokeh_script_history | safe}}
{{bokeh_script_planned | safe}}
{% endblock %}


{% block content %}

<h1>
  {{entity|get_model_verbose_name}}
  <b>{{entity}}</b>
  <a href="{{entity.get_admin_url}}">✎</a>
</h1>

{% if entity|get_class_name == 'Plot' %}
<h2>{% translate "Plot details" %}</h2>
<ul>
  <li>
    {% translate "Sectors:" %}
    {% for ancestor in entity.sector.get_ancestors %}
      <a href="{{ancestor.get_absolute_url}}">{{ancestor}}</a> &gt;
    {% endfor %}
    <a href="{{entity.sector.get_absolute_url}}">{{entity.sector}}</a>
  </li>
  <li>{% translate "Sections rotation period:" %} {{entity.rotation_sections}}</li>
  <li>{% translate "Treatment rotation period:" %} {{entity.rotation_treatments}}</li>
  <li>{% translate "Next planned section:" %} {{entity.planned_next_section}}</li>
  <li>{% translate "Next planned treatment:" %} {{entity.planned_next_treatment}}</li>
</ul>
{% else %}
<ul>
  <li>
    {% translate "Sectors:" %}
    {% for ancestor in entity.get_ancestors %}
      <a href="{{ancestor.get_absolute_url}}">{{ancestor}}</a>{% if not forloop.last %} &gt;{% endif %}
    {% endfor %}
  </li>
  <li>{% translate "Total sections:" %} {{entity.computed_sections_total}}</li>
  <li>{% translate "Total inventories:" %} {{entity.computed_inventories_total}}</li>
  <li>{% translate "Total treatments:" %} {{entity.computed_treatments_total}}</li>
</ul>
{% endif %}


<h2>{% translate "Sections" %}</h2>

<h3>{% translate "Per year" %}</h3>
<table>
  <thead>
    <tr><th>{% translate "year" %}</th><th>{% translate "count" %}</th></tr>
  </thead>
  <tbody>
    {% for year, value in entity.computed_sections_detail.items %}
    <tr><td>{{year}}</td><td>{{value}}</td></tr>
    {% endfor %}
  </tbody>
</table>

<h3>{% translate "Full list" %}</h3>
<table>
  <thead>
    <tr>
      <th>plot</th>
      <th>date</th>
      <th>remark</th>
      <th>volume</th>
    </tr>
  </thead>
  <tbody>
  {% for section in entity.section_set.all %}
    <tr>
      <td><a href="{{section.plot.get_absolute_url}}">{{section.plot}}</a></td>
      <td>{{section.date}}</td>
      <td>{{section.remark}}</td>
      <td>{{section.volume}} m<sup>3</sup></td>
    </tr>
  {% empty %}
    <tr><td colspan="4"><i>No results</i></td></tr>
  {% endfor %}
  </tbody>
</table>


<h2>{% translate "Treatment" %}</h2>

<h3>{% translate "Per year" %}</h3>
<table>
  <thead>
    <tr><th>{% translate "year" %}</th><th>{% translate "count" %}</th></tr>
  </thead>
  <tbody>
    {% for year, value in entity.computed_inventories_detail.items %}
    <tr><td>{{year}}</td><td>{{value}}</td></tr>
    {% endfor %}
  </tbody>
</table>

<h3>{% translate "Full list" %}</h3>
<table>
  <thead>
    <tr>
      <th>plot</th>
      <th>date</th>
      <th>remark</th>
      <th>description</th>
    </tr>
  </thead>
  <tbody>
  {% for treatment in entity.treatment_set.all %}
    <tr>
      <td><a href="{{treatment.plot.get_absolute_url}}">{{treatment.plot}}</a></td>
      <td>{{treatment.date}}</td>
      <td>{{treatment.remark}}</td>
      <td>{{treatment.description}}</td>
    </tr>
  {% empty %}
    <tr><td colspan="4"><i>No results</i></td></tr>
  {% endfor %}
  </tbody>
</table>


<h2>{% translate "Inventories" %}</h2>

<h3>{% translate "Per year" %}</h3>
<table>
  <thead>
    <tr><th>{% translate "year" %}</th><th>{% translate "count" %}</th></tr>
  </thead>
  <tbody>
    {% for year, value in entity.computed_treatments_detail.items %}
    <tr><td>{{year}}</td><td>{{value}}</td></tr>
    {% endfor %}
  </tbody>
</table>

<h3>{% translate "Full list" %}</h3>
<table>
  <thead>
    <tr>
      <th>plot</th>
      <th>date</th>
      <th>remark</th>
      <th>standing_volume</th>
    </tr>
  </thead>
  <tbody>
  {% for inventory in entity.inventory_set.all %}
    <tr>
      <td><a href="{{inventory.plot.get_absolute_url}}">{{inventory.plot}}</a></td>
      <td>{{inventory.date}}</td>
      <td>{{inventory.remark}}</td>
      <td>{{inventory.standing_volume}} m<sup>3</sup></td>
    </tr>
  {% empty %}
    <tr><td colspan="4"><i>No results</i></td></tr>
  {% endfor %}
  </tbody>
</table>

<h2>{% translate "Statistiques" %}</h2>
{{bokeh_graph_history | safe}}
{{bokeh_graph_planned | safe}}
{% endblock %}
